# Материал на тему «Сессии»

## Общие понятия
Сессия - это некоторое количество последовательных запросов, совершенных одним пользователем из одного браузера в течение некоторого времени. Например, когда Вы заходите на 
определенный сайт и выполняете различные действия не переходя на другие вебсайты (читаете новости или статьи, просматривете видео и т.п.). 

Сессия может сохранять какие-либо временные данные, которые должны быть доступны, пока пользователь работает с приложением, и не требуют постоянного хранения. Это могут быть 
данные, не требующие хранения в базе данных, такие как пользовательская корзина на сайте интернет-магазина, или же это могут быть данные, которые не часто меняются и для 
ускорения доступа к ним они сохраняются в сессии, например, отображаемое имя пользователя.

Сами данные сессии хранит сервер, а пользователь сохраняет идентификатор сессии (уникальное значение, которое позволяет найти нужную сессию) в виде данных в Cookie (да-да, 
тех самых, которые сайты вечно просят Вас разрешить сохранять).

## Конфигурация
Для настройки работы с сессиями в Asp.Net Core требуется внести изменения в класс ```Startup```, который является классом, настраивающим работу сервера.

Метод ```ConfigureServices``` отвечает за добавление различной логики во всем приложении, храня их в виде т.н. сервисов для того, чтобы ими можно было воспользоваться 
во всем приложении. В данном методе нам следует добавить хранилище данных сессий, сделаем это с помощью метода ```AddDistributedMemoryCache```.
После этого добавим сам механизм работы с сессиями и добавления их идентификатора в Cookie, используя метод ```AddSession```. Также в метод AddSession можно передать 
функцию для настройки параметров сессии, мы добавим Cookie параметр HttpOnly, который не позволит использовать данные Cookie из JavaScript.

Для того, чтобы наше приложение знало, что мы хотим пользоваться сессиями и умело с ними работать, в методе ```Configure``` вызовем метод ```UseSession```. На этом настройка 
сервера для работы с сессиями завершена.


## Работа с сессиями
Для работы с сессией мы должны обратиться к ```HttpContext```, который имеет поле ```Session```. При работе с сессией нам доступные следующие методы:

- ```Clear()``` - полностью очищает данные сессии
- ```Get(string key)``` - получает по ключу ```key``` значение в виде массива байтов
- ```GetInt32(string key)``` - получает по ключу ```key``` значение в виде целочисленного значения
- ```GetString(string key)``` - получает по ключу ```key``` значение в виде строки
- ```Set(string key, byte[] value)``` - устанавливает по ключу ```key``` значение ```value```, имеющее тип массив байтов
- ```SetInt32(string key, int value)``` - устанавливает по ключу ```key``` значение ```value```, имеющее тип целочисленное значение
- ```SetString(string key, string value)``` - устанавливает по ключу key значение ```value```, имеющее тип строка
- ```Remove(string key)``` - удаляет значение по ключу ```key```

## Пример
В примере мы использовали 2 метода контроллера - ```Get()``` и `SetName(string name)```.

Первый метод проверяет наличие в данных сессий имени пользователя, по ключу "_Name". Если имени пользователя нет в данных сессии, например, если истекла, данный 
метод устанавливает имя "Guest". Затем метод забирает существующее в сессии имя пользователя и выводит приветственное сообщение.

Второй метод устанавливает имя пользователя в сессии. Если пользователь хочет поменять отображаемое имя пользователя и на вебстранице отправляет запрос с новым именем 
пользователя, данный запрос обрабатывается этим методом и новое имя пользователя устанавливается в данных сессии.
